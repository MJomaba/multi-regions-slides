---
title: "Multi-regions Modelling"
author: "Marc Baguelin & Ed Knock"
format:
  revealjs:
    theme: dark
    slide-number: true
    highlight-style: github
    chalkboard: true
    controls: true
    incremental: false
    center: false
    transition: none
    toc: false
fontsize: 18pt
---

## Overview of the framework

### Motivation

- Traditional epidemic models are often fitted to **single outbreaks**, limiting information sharing across regions.
- Mixed-effects/hierarchical models are standard in PK/within-host modeling but have not been adapted to **transmission dynamics** at population level.

### Our objective

- **Bayesian hierarchical framework** for **multi-region** epidemic modeling.
- **Features**
  - Full **uncertainty quantification** via priors/posteriors
  - **Parallelizable** inference
  - Model specification via a high-level DSL (`odin` and `monty`)

## Hierarchical structure

![](Hierarchical_diag.png){width=300}

## Hierarchical model factorisation

### Structure

Let groups be $G=\{1,\dots,K\}$. For each group $i$ we observe data $y_i$ with **local** parameters $\theta_i$ and **global** parameters $\phi$ shared across groups.

### Posterior factorisation (Bayesian)

$$
\log p(\phi,\{\theta_i\}_{i=1}^K\mid y) 
= \sum_{i=1}^K \log p(y_i\mid \theta_i,\phi)
 + \sum_{i=1}^K \log p(\theta_i\mid \phi)
 + \log p(\phi)\,.
$$

Here we are Bayesian but also has non-Bayesian interpretation.

### Computation (blocked, parallel)

- Conditional on $\phi$, locals $\{\theta_i\}$ update **in parallel**.
- Global update targets $\phi$ using $\sum_i(\log L_i+\log R_i)+\log R_0$.

## Where are we now?

### What already exists
- odin models and can be run and in "groups" in dust-> see script
- A global likelihood can be derived from this
- Packers can use the hierarchical structure
- Densities can be written as functions
- Model can be fit using existing algorithms

### What remains to be done
- fitting algorithms do not exploit the hierarchical structure
- not possible to output individual 'regional' likelihoods
- not possible to handle groups in monty DSL

## Workplan

- Setup grouped models in monty properly (and combining of grouped models), and ensure dust outputs likelihoods by group
- Work on nested algorithm and ensure observations are handled correctly
- Handle groups in the monty DSL


